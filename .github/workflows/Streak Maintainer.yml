name: Minimal Streak Commit

on:
  schedule:
    - cron: "0 */6 * * *"   # every 6 hours (UTC)
  workflow_dispatch:        # manual run from UI

jobs:
  commit_streak:
    runs-on: ubuntu-latest

    env:
      AUTHOR_NAME: "Runarok"
      AUTHOR_EMAIL: "RunarokHrafn@gmail.com"

    steps:
      # Checkout full history and keep credentials so we can push with GITHUB_TOKEN
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          persist-credentials: true
          ref: main

      # Configure commit identity so commits attribute to your account
      - name: Configure Git identity
        run: |
          git config user.name "${{ env.AUTHOR_NAME }}"
          git config user.email "${{ env.AUTHOR_EMAIL }}"

      # Rebase onto remote to avoid non-fast-forward push rejections
      - name: Update local branch
        run: git pull --rebase origin main

      # Make one empty commit with explicit author/committer (no files changed)
      - name: Create empty commit (attributed to you)
        run: |
          GIT_AUTHOR_NAME="${AUTHOR_NAME}" \
          GIT_AUTHOR_EMAIL="${AUTHOR_EMAIL}" \
          GIT_COMMITTER_NAME="${AUTHOR_NAME}" \
          GIT_COMMITTER_EMAIL="${AUTHOR_EMAIL}" \
          git commit --allow-empty -m "chore: maintain_daily_streak ($(date -u +%Y-%m-%dT%H:%M:%SZ))"

      # Push the new commit to the default branch
      - name: Push commit
        run: git push origin HEAD:main
